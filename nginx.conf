server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # === ROOT → /de/ (permanent redirect for SEO) ===
    location = / {
        return 301 /de/;
    }

    # === PHANTOM-URL BLOCKERS (indexed by Google but should not exist) ===
    location ~ ^/index\.php {
        return 410;
    }
    location /archive/ {
        return 410;
    }

    # === SPRACHROUTEN ===
    location /de/ {
        try_files $uri $uri.html /de/index.html;
    }
    location /fr/ {
        try_files $uri $uri.html /fr/index.html;
    }
    location /en/ {
        try_files $uri $uri.html /en/index.html;
    }

    # === 301 REDIRECTS (SEO) ===
    location = /about/ {
        return 301 /de/about.html;
    }
    location = /about {
        return 301 /de/about.html;
    }
    location = /services/ {
        return 301 /de/services.html;
    }
    location = /services {
        return 301 /de/services.html;
    }
    location = /services/dpp/ {
        return 301 /de/dpp.html;
    }
    location = /services/dpp {
        return 301 /de/dpp.html;
    }
    location = /services/b2b-chemie/ {
        return 301 /de/services.html#chemikalienhandel;
    }
    location = /services/b2b-chemie {
        return 301 /de/services.html#chemikalienhandel;
    }
    location = /services/reach/ {
        return 301 /de/services.html#compliance;
    }
    location = /services/reach {
        return 301 /de/services.html#compliance;
    }
    location = /contact/ {
        return 301 /de/contact.html;
    }
    location = /contact {
        return 301 /de/contact.html;
    }
    location = /faq/ {
        return 301 /de/faq.html;
    }
    location = /faq {
        return 301 /de/faq.html;
    }
    location = /legal/ {
        return 301 /de/legal.html;
    }
    location = /legal {
        return 301 /de/legal.html;
    }
    location = /privacy/ {
        return 301 /de/privacy.html;
    }
    location = /privacy {
        return 301 /de/privacy.html;
    }

    # Entfernte Seiten → Homepage
    location = /partner/ {
        return 301 /de/;
    }
    location = /partner {
        return 301 /de/;
    }
    location = /blog/ {
        return 301 /de/;
    }
    location = /blog {
        return 301 /de/;
    }
    location = /dental/ {
        return 301 /de/;
    }
    location = /dental {
        return 301 /de/;
    }

    # Legacy language redirects
    location = /de {
        return 301 /de/;
    }
    location = /fr {
        return 301 /fr/;
    }
    location = /en {
        return 301 /en/;
    }

    # === API ===
    location /api/ {
        proxy_pass http://backend:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
